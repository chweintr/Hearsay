"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1874],{10310:(e,t,i)=>{i.d(t,{b:()=>r});class r{get id(){return this.asset.id}setImageURL(e){this._imageURL=e}get media(){return this.asset.media}get url(){return"image"===this.asset.media.media_type||"video"===this.asset.media.media_type?this.asset.media.url:""}get presigned_url(){return this.asset.presigned_url}get state(){return this.asset.state}set state(e){this.asset.state=e}get aspectRatio(){return 0!=this.height?this.width/this.height:1}get width(){var e;return null!=(e=this.asset.media.width)?e:0}get height(){var e;return null!=(e=this.asset.media.height)?e:0}get thumbnail(){return this.asset.thumbnail}get localImageURL(){return this._imageURL}set localImageURL(e){this._imageURL=null!=e?e:void 0}constructor(e,t){this.asset=e,this._imageURL=t}}},16625:(e,t,i)=>{i.d(t,{Am:()=>n,FY:()=>d,Kk:()=>s,m7:()=>o});var r=i(81915),a=i(80901);function n(e,t){s(e,t)}function o(e,t){l(e,t,(e,t)=>{e.ok&&t.pages[e.val.pageIndex].generations.splice(e.val.mediaIndex,1)})}function s(e,t){l(e.id,t,(t,i)=>{t.ok?i.pages[t.val.pageIndex].generations[t.val.mediaIndex]=e:i.pages[0].generations.unshift(e)})}function d(e,t){u(e,i=>{e.setQueryData(i.queryKey,e=>e?(0,r.jM)(e,e=>{e.pages=e.pages.map(e=>(e.generations=e.generations.filter(e=>e.project_id!==t),e))}):e)})}function l(e,t,i){u(t,n=>{t.setQueryData(n.queryKey,t=>t?(0,r.jM)(t,t=>{i(function(e,t){let i=(0,r.c2)(t);if(!i)return(0,a._)(void 0);for(let t=0;t<i.pages.length;t++){let r=i.pages[t];for(let i=0;i<r.generations.length;i++)if(r.generations[i].id===e)return(0,a.Ok)({pageIndex:t,mediaIndex:i})}return(0,a._)(void 0)}(e,t),t)}):t)})}function u(e,t){e.getQueryCache().findAll({queryKey:["generations"]}).forEach(t)}},17510:(e,t,i)=>{i.d(t,{L1:()=>s,Oi:()=>u,YI:()=>l,base64ToRGBGrid:()=>d});var r=i(68100),a=i(25576),n=i(10645),o=i(21464);function s(e){let{rgbGrid:t,className:i=""}=e,o=(0,a.useRef)(null);return(0,a.useEffect)(()=>{let e=o.current;if(!e)return;let i=e.getContext("2d");i&&function(e,t,i){e.width=5,e.height=5;for(let e=0;e<5;e++)for(let r=0;r<5;r++){let[a,n,o]=i[e][r];t.fillStyle="rgb(".concat(a,",").concat(n,",").concat(o,")"),t.fillRect(r,e,1,1)}let r=document.createElement("canvas"),a=r.getContext("2d");a&&(r.width=100*e.width,r.height=100*e.height,a.imageSmoothingEnabled=!0,a.imageSmoothingQuality="high",a.fillStyle="black",a.fillRect(0,0,r.width,r.height),a.drawImage(e,0,0,r.width,r.height),e.width=r.width,e.height=r.height,t.drawImage(r,0,0))}(e,i,t)},[t]),(0,r.jsx)("canvas",{ref:o,className:(0,n.QP)("w-full h-full object-cover",i)})}function d(e){let t=atob(e),i=new Uint8Array(t.length);for(let e=0;e<t.length;e++)i[e]=t.charCodeAt(e);let r=[],a=0;for(let e=0;e<5;e++){let e=[];for(let t=0;t<5;t++)e.push([i[a],i[a+1],i[a+2]]),a+=3;r.push(e)}return r}function l(e){let t=new Uint8Array(75),i=0;for(let r=0;r<5;r++)for(let a=0;a<5;a++){let[n,o,s]=e[r][a];t[i]=n,t[i+1]=o,t[i+2]=s,i+=3}return btoa(String.fromCharCode.apply(null,Array.from(t)))}async function u(e){return new Promise((t,i)=>{var r;let a=new Image;a.crossOrigin=null!=(r=(0,o.n)(e))?r:"",a.onload=()=>{let e=document.createElement("canvas"),r=e.getContext("2d");if(!r)return void i(Error("Could not get canvas context"));e.width=5,e.height=5,r.drawImage(a,0,0,5,5);let n=r.getImageData(0,0,5,5).data,o=[],s=0;for(let e=0;e<5;e++){let e=[];for(let t=0;t<5;t++)e.push([n[s],n[s+1],n[s+2]]),s+=4;o.push(e)}t(o)},a.onerror=()=>{i(Error("Failed to load image"))},a.src=e})}},17740:(e,t,i)=>{i.d(t,{A:()=>s,n:()=>o});var r=i(68100),a=i(25576);let n=(0,a.createContext)(!1);function o(e){let{children:t}=e,[i,o]=(0,a.useState)(!1);return(0,a.useEffect)(()=>{if(i)return;let e=new AbortController,{signal:t}=e;return document.body.addEventListener("click",()=>o(!0),{signal:t}),()=>{e.abort()}},[i]),(0,r.jsx)(n.Provider,{value:i,children:t})}function s(){return(0,a.useContext)(n)}},21464:(e,t,i)=>{function r(e){return null!=e&&void 0!==e.width&&void 0!==e.height}function a(e){var t;return null!=(t=(null==e?void 0:e.url.startsWith("data:"))||(null==e?void 0:e.url.startsWith("blob:")))&&t}function n(e){return new Promise((t,i)=>{let r=new Image;r.crossOrigin="anonymous",r.onload=()=>t(r),r.onerror=()=>i(Error("Failed to load image")),r.src=e})}function o(e){return e.includes("secure-storage.lumalabs.ai")?"use-credentials":"anonymous"}i.d(t,{n:()=>o,qt:()=>r,t6:()=>a,yt:()=>n})},35142:(e,t,i)=>{i.d(t,{JV:()=>g,Jt:()=>h,YK:()=>c});var r=i(41693),a=i(25769),n=i(85058),o=i(40361),s=i(81915),d=i(25576),l=i(16625),u=i(83844);function c(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0],{projects:t,query:i,getNextPage:r}=function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0],t=(0,a.useInfiniteQuery)({queryKey:["projects"],queryFn:async e=>{let{pageParam:t}=e;return(0,u._P)({limit:100,skip:100*t})},retry:!1,refetchOnWindowFocus:!1,refetchOnMount:!1,initialPageParam:0,getNextPageParam:(e,t,i,r)=>{if(e.has_more)return i+1},enabled:e}),i=(0,d.useMemo)(()=>{var e,i;return null!=(i=null==(e=t.data)?void 0:e.pages.flatMap(e=>e.projects))?i:[]},[t.data]);return{query:t,projects:i,getNextPage:function(){t.hasNextPage&&!t.isFetchingNextPage&&t.fetchNextPage()}}}(e),c=function(){let e=(0,n.useQueryClient)();return(0,o.useMutation)({mutationFn:u.gA,onSuccess:t=>{e.setQueryData(["projects"],e=>e?(0,s.jM)(e,e=>{e.pages[0].projects.unshift({id:t.id,metadata:t.metadata})}):e)},onError:e=>{console.error("Error creating project",e)}})}(),h=function(){let e=(0,n.useQueryClient)();return(0,o.useMutation)({mutationFn:e=>(0,u.xx)(e),onMutate:t=>{let i=e.getQueryData(["projects"]);if(null==i)return;let r={...i,pages:i.pages.map(e=>({...e,projects:e.projects.filter(e=>e.id!=t)}))};return e.setQueryData(["projects"],r),(0,l.FY)(e,t),{previousProjects:i}},onError:(t,i,r)=>{console.error("Error deleting project",t),(null==r?void 0:r.previousProjects)&&e.setQueryData(["projects"],r.previousProjects)}})}(),g=t.sort((e,t)=>{let i=new Date(e.metadata.updated_at);return new Date(t.metadata.updated_at).getTime()-i.getTime()}),p=i.isLoading;return{...i,projectListAscending:g,isLoading:p,getNextPage:r,createProject:function(e,t){return new Promise((i,r)=>{c.mutate({id:e,settings:t},{onSuccess:i,onError:r})})},deleteProject:function(e){h.mutate(e)}}}function h(e,t,i){e.setQueryData(["projects"],e=>e?{...e,pages:e.pages.map(e=>({...e,projects:e.projects.map(e=>e.id===t?{...e,metadata:i}:e)}))}:e)}function g(e,t,i){let a=t.queryClient;(0,l.Kk)(e,a);let n=-1;a.setQueryData(["project",i],e=>e?(n=t.getGeneration(e.generations).filter(e=>e.favorited).length,(0,s.jM)(e,e=>{e.project.metadata.updated_at=(0,r.$k)()})):e),a.setQueryData(["projects"],t=>{if(!t)return t;let r=e.getImage();return(0,s.jM)(t,e=>{e.pages.forEach(e=>{e.projects.forEach(e=>{if(e.id===i){if(r)if(e.metadata.cover_images){let t=[...e.metadata.cover_images,r].slice(-3);e.metadata.cover_images=t}else e.metadata.cover_images=[r];-1!=n&&(e.metadata.favorite_count=n)}})})})})}},41693:(e,t,i)=>{i.d(t,{$k:()=>M,AG:()=>P,AN:()=>m,Ds:()=>l,EC:()=>p,Ic:()=>_,QN:()=>C,S8:()=>w,U2:()=>x,XB:()=>h,XT:()=>k,Xz:()=>D,_i:()=>v,aF:()=>f,aQ:()=>b,ab:()=>d,fR:()=>y,h5:()=>R,hA:()=>j,k2:()=>c,kx:()=>q,nk:()=>U,pA:()=>G,sI:()=>u,xW:()=>I,y6:()=>g,zz:()=>E});var r=i(17510),a=i(98209),n=i(51202),o=i(59490),s=i(62269);function d(e,t){if(!e)return"deleted";if("pending"===e.state||"processing"===e.state)return e.state;if("deleted"===e.state)return"deleted";let i=A(e,t);if(i)return i.state;let r=u(e,t);if(r)switch(r.artifact_type){case"image":if(r.image)return"completed";break;case"video":if(r.video||r.video_raw)return"completed"}return e.state}function l(e,t){var i,r,a,n,o,s,d,l;if(!e)return"image";let c=u(e,t);return null!=(l=null!=(d=null!=(s=null==c?void 0:c.artifact_type)?s:null==e||null==(a=e.metadata)||null==(r=a.generation_settings)||null==(i=r.model_settings)?void 0:i.media_type)?d:null==e||null==(o=e.request)||null==(n=o.model_settings)?void 0:n.media_type)?l:"image"}function u(e,t){var i;if(!e)return;if("original"===t||!w(e))return e.artifact;let r=null==(i=A(e,t))?void 0:i.artifact;return null!=r?r:e.artifact}function c(e){function t(){let t=_(e);return t>1?{width:1024,height:1024/t}:{width:1024*t,height:1024}}function i(e){return null==e.width||null==e.height?t():{width:e.width,height:e.height}}let r=u(e);if((null==r?void 0:r.artifact_type)==="image"&&r.image)return i(r.image);if((null==r?void 0:r.artifact_type)==="video"){var a,n,o;let e=null!=(o=null!=(n=null!=(a=r.video_raw)?a:r.video)?n:r.thumbnail)?o:r.last_frame;if(e)return i(e)}return t()}function h(e,t){var i,r;let a=u(e,t),n=f(a),o=A(e,t);if((null==a?void 0:a.artifact_type)!=="video")return{imageUrl:null!=(r=null==n?void 0:n.url)?r:"",uuid:e.id,editVersionId:null==o?void 0:o.id,type:"image",source:"generation",media:n};{let t=m(a);return{imageUrl:null!=(i=null==n?void 0:n.url)?i:"",uuid:e.id,editVersionId:null==o?void 0:o.id,type:"video",source:"generation",duration:null==t?void 0:t.duration,media:t}}}function g(e,t){var i;if(e)return null==(i=m(u(e,t)))?void 0:i.duration}function p(e,t){if(e)return f(u(e,t))}function f(e){var t;if(e)return"image"===e.artifact_type?e.image:null!=(t=e.thumbnail)?t:e.last_frame}function m(e){var t;if(e)return"video"===e.artifact_type?null!=(t=e.video_raw)?t:e.video:void 0}function v(e,t){if(!e)return 1;let i=p(e,t);return i&&i.width&&i.height?i.width/i.height:"original"===t?1:_(e,t)}function _(e,t){var i,r,a,o,d,l;let u;if(!e)return 1;if((0,s.m)(e))return e.aspectRatio;let c=A(e,t);return u=c?null==(r=c.metadata)||null==(i=r.generation_settings)?void 0:i.aspect_ratio:null!=(l=null==(o=e.metadata)||null==(a=o.generation_settings)?void 0:a.aspect_ratio)?l:null==(d=e.request)?void 0:d.aspect_ratio,(0,n.KD)(null!=u?u:"1:1")}function y(e){var t,i,r,a,n,o;let s=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e?(s?null!=(n=null==(i=e.edit_thread)||null==(t=i.versions)?void 0:t.length)?n:0:null!=(o=null==(a=e.edit_thread)||null==(r=a.versions)?void 0:r.filter(e=>"deleted"!==e.state).length)?o:0)+1:0}function w(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return y(e,t)>1}function b(e,t){var i,r,a,n,o,s,d,l,c,h,g,p,f,v,_;let y;if(!e)return;if("original"===t)return null==e||null==(o=e.metadata)||null==(n=o.generation_settings)||null==(a=n.model_settings)?void 0:a.resolution;let w=A(e,t);if(null==w){let t=null==e||null==(l=e.metadata)||null==(d=l.generation_settings)||null==(s=d.model_settings)?void 0:s.resolution,i=null==(c=e.request)?void 0:c.request_type;if(y=t||("upscale"===i?null==(h=e.request)?void 0:h.settings.resolution:null==(p=e.request)||null==(g=p.model_settings)?void 0:g.resolution))return y;let r=m(u(e));if(r)return r.width&&r.height?S(Math.min(r.width,r.height)):void 0}if("upscale"===(null==w||null==(r=w.request)||null==(i=r.payload)?void 0:i.payload_type))return null==w||null==(_=w.request)||null==(v=_.payload)||null==(f=v.settings)?void 0:f.resolution;let b=m(u(e,w));if(b)return b.width&&b.height?S(Math.min(b.width,b.height)):void 0}function S(e){return e<=680?"540p":e<=900?"720p":e<=1200?"1080p":"2160p"}function E(e,t){var i;return null==(i=f(u(e,t)))?void 0:i.url}function P(e){let t=f(u(e)),i=null==t?void 0:t.palette;return(null==i?void 0:i.grid)?(0,r.base64ToRGBGrid)(i.grid):void 0}function A(e,t){var i,r,a;let n=null!=(a=null==t?void 0:t.id)?a:null==(i=e.edit_thread)?void 0:i.active_version_id;return null==(r=e.edit_thread)?void 0:r.versions.find(e=>e.id===n)}function I(e){var t,i,r,a,n;if(e)return null!=(n=null==(i=e.edit_thread)||null==(t=i.versions.find(t=>{var i;return t.id===(null==(i=e.edit_thread)?void 0:i.active_version_id)}))?void 0:t.request)?n:null==(a=e.edit_thread)||null==(r=a.versions.slice(-1)[0])?void 0:r.request}function j(e){var t;return null==(t=(0,o.p)(e))?void 0:t.model_name}function q(e){let t=d(e);if(!e||"completed"!==t)return;let i=(0,o.p)(e),r=[];return(null==i?void 0:i.media_type)==="video"&&(i.dynamic_range&&"standard"!==i.dynamic_range&&r.push({type:"dynamicRange",dynamicRange:i.dynamic_range}),i.model_name&&![].includes(i.model_name)&&r.push({type:"model",model:i.model_name}),r.push({type:"video",duration:i.duration?(0,a.a3)(i.duration):null,resolution:i.resolution}),i.has_audio&&r.push({type:"audio"})),r}function R(e){var t,i,r;if(e.media_request){let t=e.media_request;return null!=(r=null!=(i=t.rich_text)?i:t.text)?r:t.prompt}return null==(t=e.request)?void 0:t.prompt}function x(e){let t=R(e);return"string"==typeof t?t:null!=t?t.elements.map(T).join(""):void 0}function M(){return new Date().toISOString()}function T(e){switch(e.type){case"text_element":return e.text;case"attachment_qualifier":return"@".concat(e.qualifier);case"entity_reference":return"@".concat(e.entity_id);case"concept_pill":return e.value}}function k(e){let t=j(e);return"processing"===e.state&&"ray-v3-reasoning"===t}function D(e){return!!e&&("image"===e.artifact_type&&!!e.image||"video"===e.artifact_type&&(!!e.video||!!e.preview||!!e.video_raw||!!e.thumbnail||!!e.last_frame)||!1)}function C(e,t){return"draft"===b(e,t)}function U(e){var t;let i=(0,o.p)(e);return null!=(t=null==i?void 0:i.dynamic_range)?t:"standard"}function G(e){let t=(0,o.p)(e);if(!t)return{hasHDR:!1,hasHDR_EXR:!1,hasSDROnly:!0};let i=u(e),r="hdr"===t.dynamic_range||"hdr_exr"===t.dynamic_range,a="hdr_exr"===t.dynamic_range&&(null==i?void 0:i.artifact_type)==="video"&&(null==i?void 0:i.video_hdr_exr)!=null;return{hasHDR:r,hasHDR_EXR:a,hasSDROnly:!r&&!a}}},44821:(e,t,i)=>{i.d(t,{r:()=>r});function r(e,t,i){if(void 0===window)return[t,()=>{},()=>{}];function r(t){localStorage.setItem(e,t)}function a(){localStorage.removeItem(e)}let n=localStorage.getItem(e);return n&&(!i||i(n))?[n,r,a]:[t,r,a]}},49340:(e,t,i)=>{function r(e,t){return e.map(null!=t?t:e=>e).filter(e=>null!=e)}function a(e,t,i){if(!e)return[t];let r=[...e],a=e.findIndex(e=>e.id===t.id);return a>=0?r[a]=i?i(r[a]):t:r.push(t),r}function n(e,t){return 0===e.length?[]:e.reduce((e,i)=>{if(0===e.length)return e.push([i]),e;let r=e[e.length-1];return t(r[r.length-1])?e.push([i]):r.push(i),e},[])}function o(e,t){let i=[...e],[r]=i.splice(t,1);return i.push(r),i}function s(e,t,i){if(null==i)return[0,1+2*t];if(e.length<=1+2*t)return[0,e.length];let r=Math.max(0,i-t),a=Math.min(e.length,i+t+1);if(a-r<1+2*t)if(0===r)return[0,1+2*t];else return[e.length-(1+2*t),e.length];return[r,a]}function d(e,t){let i=[...e];for(;i.length<t;)i.push(null);return i}i.d(t,{Kc:()=>r,LM:()=>o,M2:()=>n,WR:()=>d,b$:()=>a,jP:()=>s})},49909:(e,t,i)=>{i.d(t,{B3:()=>d,ER:()=>o,L7:()=>u,ZD:()=>s,by:()=>l,qi:()=>a,r4:()=>n,zX:()=>c});var r=i(44821);function a(e){return"universal"!==e}function n(){let[e,t]=(0,r.r)("promptType","keyframe",e=>["keyframe","describe","condition"].includes(e));return[e,t]}function o(){let[e,t]=(0,r.r)("modifyImageModel","image-modify-v0",e=>["image-modify-v0","photon-v2"].includes(e));return[e,t]}function s(){let[e,t]=(0,r.r)("universalImageModel","image-v2",e=>["image-v2","photon-v2"].includes(e));return[e,t]}function d(){let[e,t]=(0,r.r)("conditionImageModel","image-v2",e=>["image-v2","photon-v2"].includes(e));return[e,t]}let l={universal:"Describe",describe:"Modify",condition:"Reference",keyframe:"Keyframe",upscale:"Upscale",vary:"Show More",audio:"Add Audio",branch:"Branch",reframe_preview:"Reframe Preview",retouch:"Retouch",upload:"Upload",promote_attachment:"Upload"};function u(e){let t=c(e);if(t)return l[t]}function c(e){var t,i;if(null==(t=e.media_request)?void 0:t.prompt_type)switch(e.media_request.prompt_type){case"universal":return"universal";case"describe":return"describe";case"condition":return"condition";case"keyframe":return"keyframe";case"upscale_generation":return"upscale";case"vary_generation":return"vary";case"add_audio_generation":return"audio";case"promote_upload":return"upload";case"branch_generation":return"branch";case"reframe_preview":return"reframe_preview";case"promote_attachment":return"promote_attachment"}switch(null==(i=e.request)?void 0:i.request_type){case"text_to_image":case"text_to_video":return"universal";case"image_to_image":return"describe";case"image_to_video":case"extend":case"keyframe":return"keyframe";case"upscale":return"upscale"}}},51202:(e,t,i)=>{i.d(t,{KD:()=>o,_C:()=>a,tW:()=>s});var r=i(23383);let a=["9:16","3:4","1:1","4:3","16:9","21:9"],n={"9:16":9/16,"3:4":3/4,"1:1":1,"4:3":4/3,"16:9":16/9,"21:9":21/9};function o(e){let t=n[e];if(t)return t;let i=e.split(":").map(Number);return 2===i.length?i[0]/i[1]:1}function s(e){return 0!==e&&(0,r.E)(e)?Object.entries(n).reduce((t,i)=>Math.abs(i[1]-e)<Math.abs(t[1]-e)?i:t,["1:1",1])[0]:"1:1"}},59490:(e,t,i)=>{i.d(t,{p:()=>n});var r=i(49909),a=i(41693);function n(e){var t,i,n,o,s,d,l,u,c,h,g,p,f,m,v,_,y,w,b,S;if(!e)return;let E=(0,a.sI)(e),P=(0,a.AN)(E),A=P?"video":"image",I=(0,r.L7)(e),j=null==P?void 0:P.duration,q=(0,a.aQ)(e),R=(0,a._i)(e),x=(null==(n=e.metadata)||null==(i=n.generation_settings)||null==(t=i.model_settings)?void 0:t.model_name)||(null==(s=e.request)||null==(o=s.model_settings)?void 0:o.model_name),M="video"===A?(null==(u=e.metadata)||null==(l=u.generation_settings)||null==(d=l.model_settings)?void 0:d.dynamic_range)||(null==(h=e.request)||null==(c=h.model_settings)?void 0:c.dynamic_range):void 0,T=(null==e||null==(g=e.media_request)?void 0:g.prompt_type)==="add_audio_generation";if(e.edit_thread&&e.edit_thread.active_version_id){let t=null==e||null==(f=e.edit_thread)||null==(p=f.versions)?void 0:p.findIndex(t=>{var i;return t.id==(null==e||null==(i=e.edit_thread)?void 0:i.active_version_id)});t>=0&&(T=(null==(v=e.edit_thread.versions[t].request)||null==(m=v.payload)?void 0:m.payload_type)==="add_audio",M=(null==(y=e.edit_thread.versions[t].request)||null==(_=y.payload)?void 0:_.payload_type)==="upscale"?null==(S=e.edit_thread.versions[t].request)||null==(b=S.payload)||null==(w=b.settings)?void 0:w.dynamic_range:void 0)}return{media_type:A,prompt_type:I,model_name:x,aspect_ratio:R,resolution:q,duration:j,has_audio:T,dynamic_range:M}}},62241:(e,t,i)=>{i.d(t,{X:()=>g});var r=i(83844),a=i(81915),n=i(59490),o=i(49909),s=i(41693),d=i(62269),l=i(70801);class u{get artifact(){return this.generation.artifact}get created_at(){return this.generation.created_at}get edit_thread(){return this.generation.edit_thread}get reasoning_thread(){return this.generation.reasoning_thread}get favorited(){return this.generation.favorited}get favorited_at(){return this.generation.favorited_at}get id(){return this.generation.id}get media_request(){return this.generation.media_request}get metadata(){return this.generation.metadata}get project_id(){return this.generation.project_id}get request(){return this.generation.request}get state(){return this.generation.state}get updated_at(){return this.generation.updated_at}get user(){return this.generation.user}get user_id(){return this.generation.user_id}get visibility(){return this.generation.visibility}get generationState(){if("pending"===this.generation.state||"processing"===this.generation.state)return this.timeout?"failed":this.generation.state;if("deleted"===this.generation.state)return"deleted";if(this.generation.artifact)switch(this.generation.artifact.artifact_type){case"image":if(this.generation.artifact.image)return"completed";break;case"video":if(this.generation.artifact.video||this.generation.artifact.video_raw)return"completed"}return this.generation.state}get isReasoning(){return(0,s.XT)(this.generation)}get activeVersionId(){var e,t;return null!=(t=null==(e=this.edit_thread)?void 0:e.active_version_id)?t:null}versionId(e){return"current"===e?this.activeVersionId:"original"===e?null:e}editVersion(e){var t;let i=this.versionId(e);return null==(t=this.edit_thread)?void 0:t.versions.find(e=>e.id===i)}get isImage(){var e;return(null==(e=this.artifact)?void 0:e.artifact_type)==="image"}get isVideo(){var e;return(null==(e=this.artifact)?void 0:e.artifact_type)==="video"}get createdAt(){return Date.parse(this.generation.created_at)}get updatedAt(){return Date.parse(this.generation.updated_at)}get latestEditCreatedAt(){if(this.edit_thread){var e,t,i;return Date.parse(null!=(i=null==(t=this.edit_thread.versions.slice(-1))||null==(e=t[0])?void 0:e.created_at)?i:this.createdAt)}return this.createdAt}get isSettled(){return"completed"===this.generationState||"failed"===this.generationState||"deleted"===this.generationState}get isUploaded(){return"upload"===this.promptType}get hasEdits(){return(0,s.S8)(this.generation)}get shouldDisplayArtifact(){return"completed"===this.generationState&&null!==this.generation.artifact}get timeout(){return this.createdAt<Date.now()-1728e5}get favoritedAt(){return this.generation.favorited_at?Date.parse(this.generation.favorited_at):void 0}get size(){return(0,s.k2)(this.generation)}get width(){return this.size.width}get height(){return this.size.height}get url(){var e;return null!=(e=this.thumbnailUrl)?e:""}get media(){return"image"===this.getMediaType("current")?this.getImage("current"):this.getVideo("current")}get thumbnailUrl(){return(0,s.zz)(this.generation)}get palette(){return(0,s.AG)(this.generation)}get aspectRatio(){return(0,s._i)(this.generation)}getState(){var e,t;let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"current";return null!=(t=null==(e=this.editVersion(i))?void 0:e.state)?t:this.generationState}getMediaType(){var e,t,i,r,a,n,o,s,d;let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"current",u=this.getArtifact(l);return null!=(d=null!=(s=null==u?void 0:u.artifact_type)?s:null==(r=this.generation)||null==(i=r.metadata)||null==(t=i.generation_settings)||null==(e=t.model_settings)?void 0:e.media_type)?d:null==(o=this.generation)||null==(n=o.request)||null==(a=n.model_settings)?void 0:a.media_type}getArtifact(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"current",i=this.versionId(t);return i?null==(e=this.editVersion(i))?void 0:e.artifact:this.generation.artifact}getSize(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"current",t=()=>{let e=(0,s.Ic)(this.generation),t=l.Yh;return e>1?{width:t,height:t/e}:{width:t*e,height:t}},i=e=>null==e.width||null==e.height?t():{width:e.width,height:e.height},r=this.getArtifact(e);if((null==r?void 0:r.artifact_type)==="image"&&r.image)return i(r.image);if((null==r?void 0:r.artifact_type)==="video"){var a,n,o;let e=null!=(o=null!=(n=null!=(a=r.video_raw)?a:r.video)?n:r.thumbnail)?o:r.last_frame;if(e)return i(e)}return t()}getImage(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"current";return(0,s.aF)(this.getArtifact(e))}getVideo(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"current";return(0,s.AN)(this.getArtifact(e))}getAspectRatio(e){let t=this.getImage(e);return t&&t.width&&t.height?t.width/t.height:(0,d.m)(this)&&("original"===e||null==e)?this.aspectRatio:(0,s.Ic)(this.generation,this.editVersion(e))}getResolution(e){return(0,s.aQ)(this.generation,e)}get referenceAsset(){return(0,s.XB)(this.generation)}get attachment(){var e,t;return{id:this.id,edit_version_id:null!=(e=this.activeVersionId)?e:void 0,type:"generation",media_type:this.getMediaType(),thumbnail:{url:null!=(t=this.thumbnailUrl)?t:"",media_type:"image"}}}get mediaAttribute(){return(0,n.p)(this.generation)}get dynamicRange(){var e,t;return null!=(t=null==(e=this.mediaAttribute)?void 0:e.dynamic_range)?t:"standard"}get hasHDR(){return this.dynamicRangeValues.hasHDR}get hasHDR_EXR(){return this.dynamicRangeValues.hasHDR_EXR}get hasSDROnly(){return this.dynamicRangeValues.hasSDROnly}get dynamicRangeValues(){return(0,s.pA)(this.generation)}get badgeInfo(){return(0,s.kx)(this.generation)}get modelName(){return(0,s.hA)(this.generation)}get promptType(){return(0,o.zX)(this.generation)}get prompt(){return{promptText:"",referenceAsset:this.referenceAsset,generationSettings:this.generation.request}}get richPrompt(){if(this.media_request&&"rich_text"in this.media_request)return this.media_request.rich_text}get isRelaxedMode(){var e,t;let i=null==(t=this.generation.metadata)||null==(e=t.feature_usage)?void 0:e.dm_relaxed_usage;return null!=i&&i>0}get showEditBadge(){var e,t;return!!(null==(t=this.generation)||null==(e=t.edit_thread)?void 0:e.active_version_id)}get isUpscaled(){var e,t;return(null==(e=this.generation.media_request)?void 0:e.prompt_type)==="upscale_generation"||(null==(t=this.generation.request)?void 0:t.request_type)==="upscale"}get isAudioGeneration(){var e;return(null==(e=this.generation.media_request)?void 0:e.prompt_type)==="add_audio_generation"}constructor(e,t){this.generation=(0,a.jM)(e,i=>{i&&(i.user=null!=t?t:e.user,i.edit_thread&&(i.edit_thread.versions=i.edit_thread.versions.map(e=>e.deleted_at?{...e,state:"deleted"}:e)))})}}var c=i(16625),h=i(35142);class g extends u{static fromWebSocket(e,t,i){var a;return new g({id:e.id,artifact:e.artifacts,reasoning_thread:e.reasoning_thread,state:null!=(a=e.state)?a:e.artifacts?r.eE.processing:r.eE.pending,created_at:(0,s.$k)(),updated_at:(0,s.$k)(),user_id:i},t)}undo(){this.previousGeneration&&(this.generation=this.previousGeneration,this.previousGeneration=void 0,this.notifyUpdate())}update(e){this.previousGeneration=this.generation,this.generation=(0,a.jM)(this.generation,t=>{e(t)}),this.notifyUpdate()}updateVideoThumbnail(e){e&&this.update(t=>{var i;(null==(i=t.artifact)?void 0:i.artifact_type)==="video"&&t.artifact.thumbnail&&(t.artifact.thumbnail.url=e)})}updateThread(e){this.update(t=>{t.edit_thread={...e,versions:e.versions.map(e=>e.deleted_at?{...e,state:"deleted"}:e)}})}addVersion(e){this.update(t=>{t.edit_thread?(t.edit_thread.versions.push(e),t.edit_thread.active_version_id=e.id,t.edit_thread.updated_at=(0,s.$k)()):t.edit_thread={versions:[e],active_version_id:e.id,created_at:(0,s.$k)(),updated_at:(0,s.$k)()}})}updateEditVersion(e){this.update(t=>{var i,a;let n=null==(i=t.edit_thread)?void 0:i.versions.find(t=>t.id===e.version_id);if(n)e.state&&(n.state=e.state),e.artifact&&(n.artifact={...n.artifact,...e.artifact}),n.updated_at=(0,s.$k)();else{let i={metadata:{},artifact:e.artifact,id:e.version_id,state:null!=(a=e.state)?a:r.eE.pending,created_at:(0,s.$k)(),updated_at:(0,s.$k)()};t.edit_thread?(t.edit_thread.versions.push(i),t.edit_thread.active_version_id=e.version_id):t.edit_thread={versions:[i],active_version_id:e.version_id,created_at:(0,s.$k)(),updated_at:(0,s.$k)()}}t.updated_at=(0,s.$k)()})}deleteVersion(e){this.update(t=>{t.edit_thread&&(t.edit_thread.versions=t.edit_thread.versions.filter(t=>t.id!==e),t.edit_thread.active_version_id===e&&(t.edit_thread.active_version_id=void 0))})}updateFavorited(e){this.update(t=>{t.favorited=e,e?t.favorited_at=(0,s.$k)():t.favorited_at=void 0}),(0,h.JV)(this,this.mediaStore,this.project_id)}updateVisibility(e){this.update(t=>t.visibility=e)}updateActiveVersionId(e){this.update(t=>{t.edit_thread&&(t.edit_thread.active_version_id=null!=e?e:void 0)})}updateState(e){this.update(t=>t.state=e)}delete(){this.update(e=>e.state=r.eE.deleted),(0,c.m7)(this.generation.id,this.mediaStore.queryClient)}updateWithWebsocket(e){this.update(t=>{var i,a,n,o;t.state=null!=(i=e.state)?i:t.state,e.artifacts&&(t.state===r.eE.pending&&(t.state=r.eE.processing),(null==(a=t.artifact)?void 0:a.artifact_type)==="video"&&(null==(n=e.artifacts)?void 0:n.artifact_type)==="video"&&e.artifacts.variants?t.artifact.variants?null==(o=t.artifact.variants)||o.push(...e.artifacts.variants):t.artifact.variants=e.artifacts.variants:t.artifact={...t.artifact,...e.artifacts}),e.reasoning_thread&&(t.reasoning_thread={...e.reasoning_thread}),t.updated_at=new Date().toISOString()})}notifyUpdate(){this.mediaStore.notifyUpdate(this.generation.id)}constructor(e,t,i){super(e,i),this.mediaStore=t}}},62269:(e,t,i)=>{i.d(t,{m:()=>s,s:()=>o});var r=i(41693),a=i(95942),n=i(62241);class o extends n.X{update(e){super.update(e)}setUploading(e){this._uploading=e,this.notifyUpdate()}get uploading(){return this._uploading}get aspectRatio(){return this.optimisticAspectRatio}getAspectRatio(e){let t=this.getImage(e);return t&&t.width&&t.height?t.width/t.height:this.aspectRatio}get isPlaceholder(){var e;return null!=(e=this.placeholder)&&e}constructor(e,t,i={}){if("optimisticId"in e){var n,o,s;super(function(e){var t,i,a;return{id:e.optimisticId,state:null!=(t=e.state)?t:"pending",created_at:(0,r.$k)(),updated_at:(0,r.$k)(),visibility:"private",user_id:null!=(i=e.userId)?i:crypto.randomUUID(),media_request:null!=(a=e.media_request)?a:e.prompt,request:e.request,metadata:{generation_settings:e.settings,has_audio:e.has_audio},artifact:e.artifact}}(e),t),this.optimisticAspectRatio=(0,a.xL)(null!=(s=null!=(o=i.aspectRatio)?o:null==(n=e.settings)?void 0:n.aspect_ratio)?s:"1:1")}else super(e,t),this.optimisticAspectRatio=i.aspectRatio?(0,a.xL)(i.aspectRatio):(0,r._i)(e);this.placeholder=i.placeholder}}function s(e){return e instanceof o}},78711:(e,t,i)=>{i.d(t,{r$:()=>p,AY:()=>_,$w:()=>v,Qf:()=>m,B4:()=>f});var r=i(68100),a=i(94117),n=i(25576),o=i(83844),s=i(49340),d=i(41693);class l{get media(){return this.fleet.media}get url(){var e,t;return null!=(t=null==(e=this.fleet.media)?void 0:e.url)?t:""}get width(){var e,t;return null!=(t=null==(e=this.fleet.media)?void 0:e.width)?t:0}get height(){var e,t;return null!=(t=null==(e=this.fleet.media)?void 0:e.height)?t:0}get id(){return this.fleet.id}get aspectRatio(){return 0!=this.height?this.width/this.height:1}constructor(e){this.fleet=e}}var u=i(62241),c=i(10310);class h{hasMedia(e){return this.mediaMap.has(e)}getMedia(e){if(e)return this.mediaMap.get(e)}notifyUpdate(e){let t=this.listeners.get(e);t&&t.forEach(t=>{let i=this.getMedia(e);i&&t(i)})}getGeneration(e){if(e)if(Array.isArray(e))return(0,s.Kc)(e.map(e=>{let t=this.mediaMap.get(e);if(t&&"generation"===t.type)return t.payload}));else{let t=this.mediaMap.get(e);if(t&&"generation"===t.type)return t.payload}}getChicletImage(e){if(!(null==e?void 0:e.id))return;let t=this.mediaMap.get(e.id);if(t){if("upload"===t.type){let i={media:t.payload.thumbnail||t.payload.media,assetId:t.payload.id,source:"upload",qualifier:e.qualifier,originalAttachment:e};return t.payload.localImageURL?{...i,media:{...i.media,url:t.payload.localImageURL}}:i}if("generation"===t.type){let i=t.payload.getImage();if(!i)return;return{media:i,assetId:t.payload.id,source:"generation",qualifier:e.qualifier,originalAttachment:e}}}if(e.thumbnail||e.media)return{media:e.thumbnail||e.media,assetId:e.id,source:e.type,qualifier:e.qualifier,originalAttachment:e}}async getChicletImageFromServer(e){try{let t=await (0,o.D3)(e.id);this.addGeneration(t);let i=(0,d.EC)(t);if(!i)return;return{media:i,assetId:t.id,source:"generation",qualifier:e.qualifier,originalAttachment:e}}catch(e){return}}addMedia(e,t){this.mediaMap.set(e,t),this.notifyUpdate(e)}addGeneration(e,t){return Array.isArray(e)?this.addGenerations(e,t):this.addGenerations([e],t)[0]}addGenerations(e,t){return e.map(e=>{if(e instanceof u.X)return this.addMedia(e.id,{type:"generation",payload:e}),e;{let i=new u.X(e,this,t);return this.addMedia(e.id,{type:"generation",payload:i}),i}})}addDeletedGenerations(e){if(!e)return[];let t=e.map(e=>({id:e.id,state:"deleted",user_id:"",created_at:"",updated_at:e.deleted_at}));return this.addGenerations(t)}addUploads(e){return e.map(e=>{let t=e instanceof c.b?e:new c.b(e);return this.addMedia(e.id,{type:"upload",payload:t}),t})}addFleets(e){return e.map(e=>{let t=new l(e);return this.addMedia(e.id,{type:"fleet",payload:t}),t})}subscribe(e,t){let i=this.listeners.get(e);return i?i.push(t):this.listeners.set(e,[t]),()=>this.unsubscribe(e,t)}unsubscribe(e,t){let i=this.listeners.get(e);i&&i.filter(e=>e!==t)}clear(){this.mediaMap.clear(),this.listeners.clear()}constructor(e){this.mediaMap=new Map,this.listeners=new Map,this.queryClient=e}}let g=(0,n.createContext)(null);function p(e){let{queryClient:t,children:i}=e,[a]=(0,n.useState)(()=>new h(t));return(0,r.jsx)(g.Provider,{value:a,children:i})}function f(){let e=(0,n.useContext)(g);if(!e)throw Error("useImageStore must be used within an MediaStoreProvider");return e}function m(e){let t=f(),i=(0,a.Z)();if((0,n.useEffect)(()=>{if(e)return t.subscribe(e,i)},[t,e]),e)return t.getMedia(e)}function v(e){let t=f(),i=(0,a.Z)();if((0,n.useEffect)(()=>{if(!e)return;function r(t){(null==e?void 0:e.includes(t.payload.id))&&i()}let a=e.map(e=>t.subscribe(e,r));return()=>{a.forEach(e=>e())}},[t,e]),e)return t.getGeneration(e)}function _(e){let t=f(),i=(0,a.Z)();return(0,n.useEffect)(()=>{if(e)if(!Array.isArray(e))return t.subscribe(e,i);else{let r=e.map(e=>t.subscribe(e,i));return()=>{r.forEach(e=>e())}}},[t,e]),t.getGeneration(e)}},83844:(e,t,i)=>{i.d(t,{Ar:()=>_,Bq:()=>o,CF:()=>m,CW:()=>A,Cj:()=>k,D3:()=>p,GP:()=>d,PN:()=>l,Pw:()=>U,U1:()=>S,_P:()=>x,_w:()=>h,av:()=>y,dV:()=>T,eE:()=>n,eS:()=>s,gA:()=>b,gU:()=>q,iP:()=>C,j:()=>v,jg:()=>g,k3:()=>c,ki:()=>R,mi:()=>f,o7:()=>j,oO:()=>M,p9:()=>u,tA:()=>I,tX:()=>w,vr:()=>E,xx:()=>P,yU:()=>D,zu:()=>a});var r=i(53596);let a={image:"image",video:"video"},n={pending:"pending",processing:"processing",completed:"completed",failed:"failed",deleted:"deleted"},o={upscale:"upscale",hifi:"hifi"},s={"photon-v2":"photon-v2","image-modify-v0":"image-modify-v0","image-v2":"image-v2","image-v2-reference":"image-v2-reference","image-modify-v2-reference":"image-modify-v2-reference"},d={"ray-v1":"ray-v1","ray-v2":"ray-v2","ray-v2-flash":"ray-v2-flash","ray-v3":"ray-v3","ray-v3-flash":"ray-v3-flash","ray-v3-reasoning":"ray-v3-reasoning"};({...s,...d});let l={draft:"draft","180p":"180p","360p":"360p","540p":"540p","720p":"720p","1080p":"1080p","2160p":"2160p"},u={"5s":"5s","10s":"10s","15s":"15s","20s":"20s"},c={stylize_preview:"stylize_preview"},h={modify_preview:"modify_preview"},g=(e,t)=>(0,r.SP)({url:"/generations",method:"POST",headers:{"Content-Type":"application/json"},data:e},t),p=(e,t)=>(0,r.SP)({url:"/generations/".concat(e),method:"GET"},t),f=(e,t)=>(0,r.SP)({url:"/generations/".concat(e),method:"DELETE"},t),m=(e,t,i)=>(0,r.SP)({url:"/generations/".concat(e),method:"PATCH",headers:{"Content-Type":"application/json"},data:t},i),v=(e,t,i,a)=>(0,r.SP)({url:"/generations/".concat(e,"/edit"),method:"POST",headers:{"Content-Type":"application/json"},data:t,params:i},a),_=(e,t,i)=>(0,r.SP)({url:"/generations/".concat(e,"/edit"),method:"PATCH",headers:{"Content-Type":"application/json"},data:t},i),y=(e,t,i)=>(0,r.SP)({url:"/generations/".concat(e,"/edit/").concat(t),method:"DELETE"},i),w=(e,t)=>(0,r.SP)({url:"/user/generations/",method:"GET",params:e},t),b=(e,t)=>(0,r.SP)({url:"/projects/",method:"POST",headers:{"Content-Type":"application/json"},data:e},t),S=(e,t)=>(0,r.SP)({url:"/projects/".concat(e),method:"GET"},t),E=(e,t,i)=>(0,r.SP)({url:"/projects/".concat(e),method:"PATCH",headers:{"Content-Type":"application/json"},data:t},i),P=(e,t)=>(0,r.SP)({url:"/projects/".concat(e),method:"DELETE"},t),A=(e,t,i)=>(0,r.SP)({url:"/projects/".concat(e,"/settings/"),method:"POST",headers:{"Content-Type":"application/json"},data:t},i),I=(e,t,i)=>(0,r.SP)({url:"/projects/".concat(e,"/sections/").concat(t),method:"DELETE"},i),j=(e,t)=>(0,r.SP)({url:"/upload",method:"POST",headers:{"Content-Type":"application/json"},data:e},t),q=(e,t,i)=>(0,r.SP)({url:"/upload/".concat(e,"/process"),method:"POST",headers:{"Content-Type":"application/json"},data:t},i),R=(e,t,i)=>(0,r.SP)({url:"/upload/".concat(e,"/promote"),method:"POST",params:t},i),x=(e,t)=>(0,r.SP)({url:"/user/projects",method:"GET",params:e},t),M=(e,t,i)=>(0,r.SP)({url:"/projects/".concat(e,"/snapshot"),method:"POST",headers:{"Content-Type":"application/json"},data:t},i),T=(e,t)=>(0,r.SP)({url:"/snapshots/".concat(e),method:"GET"},t),k=(e,t)=>(0,r.SP)({url:"/snapshots/".concat(e),method:"DELETE"},t),D=e=>(0,r.SP)({url:"/rich_prompt_entities/camera_controls",method:"GET"},e),C=e=>(0,r.SP)({url:"/queue_estimations",method:"GET"},e),U=(e,t,i)=>(0,r.SP)({url:"/previews",method:"POST",headers:{"Content-Type":"application/json"},data:e,params:t},i)},94117:(e,t,i)=>{i.d(t,{Y:()=>n,Z:()=>o});var r=i(25576),a=i(55519);function n(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],[i,n]=(0,r.useState)(Date.now());return(0,a.$$)(()=>n(Date.now()),t?1e3*e:null),i}function o(){return(0,r.useReducer)(()=>({}),{})[1]}},95942:(e,t,i)=>{i.d(t,{bU:()=>n,cX:()=>o,xL:()=>s});var r=i(14587),a=i.n(r);let n=window.location.href.includes("localhost:6006");function o(){return"undefined"!=typeof navigator&&"macOS"===a().getParser(navigator.userAgent).parseOS().name}function s(e){try{let[t,i]=e.split(":").map(Number);if(isNaN(t)||isNaN(i))throw Error("Both width and height must be valid numbers");if(0===i)throw Error("Height cannot be zero");return t/i}catch(t){throw Error("Invalid aspect ratio format: ".concat(e,". ").concat(t.message))}}}}]);