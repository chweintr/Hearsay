<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Room 412 ‚Äî HEARSAY</title>
    <meta name="description" content="Stories through the door. A HEARSAY experience.">
    
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=EB+Garamond:ital,wght@0,400;0,500;0,600;1,400;1,500&family=Cinzel:wght@400;500;600&display=swap" rel="stylesheet">
    
    <!-- Simli Widget SDK -->
    <script src="https://app.simli.com/simli-widget/index.js" defer></script>
</head>
<body>
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         LANDING PAGE - Character Selection
         ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div id="landing-page" class="page active">
        <!-- Video stack - both videos in same container for blend mode to work -->
        <div class="video-blend-stack">
            <video id="landing-video" class="landing-bg-video" autoplay muted playsinline>
                <source src="assets/videos/The_Knock_Background.mp4" type="video/mp4">
            </video>
            <!-- Animated text overlay - same parent so screen blend works -->
            <video id="animated-text-video" class="animated-text-video" autoplay loop muted playsinline>
                <source src="assets/videos/Animated_Text.mp4" type="video/mp4">
            </video>
        </div>
        <div class="landing-overlay"></div>
        
        <div class="landing-content">
            <div class="landing-spacer"></div>
            
            <div class="character-gallery" id="character-gallery">
                <!-- Characters injected by JS -->
            </div>
            
            <div class="menu-buttons">
                <button id="about-btn" class="menu-btn">About</button>
                <button id="store-btn" class="menu-btn">Sensory Packs</button>
            </div>
        </div>
    </div>
    
    <!-- Coming Soon Modal -->
    <div id="coming-soon-modal" class="modal hidden">
        <div class="modal-content coming-soon-content">
            <button class="modal-close" onclick="document.getElementById('coming-soon-modal').classList.add('hidden')">&times;</button>
            <h2><span class="coming-soon-name">This character</span> is not yet available</h2>
            <p>The hotel is still preparing their room. Leave your details and we'll let you know when they're ready to receive visitors.</p>
            <form class="waitlist-form" onsubmit="event.preventDefault(); submitWaitlist(this);">
                <input type="email" name="email" placeholder="your@email.com" required>
                <button type="submit">Notify Me</button>
            </form>
        </div>
    </div>
    
    <!-- Store Modal -->
    <div id="store-modal" class="modal hidden">
        <div class="modal-content store-content">
            <button class="modal-close" onclick="document.getElementById('store-modal').classList.add('hidden')">&times;</button>
            
            <!-- Store Header with Heraldic Image -->
            <div class="store-header">
                <img src="assets/images/herlaldic.png" alt="The Knock Crest" class="store-crest">
                <h1 class="store-title">The Hotel Provisions</h1>
            </div>
            
            <!-- Audio Controls in Store -->
            <div class="store-audio-controls">
                <button id="store-audio-toggle" class="audio-toggle-mini">üîä</button>
                <div class="volume-sliders-mini">
                    <label>Ambient</label>
                    <input type="range" id="store-ambient-volume" min="0" max="100" value="65">
                    <label>Music</label>
                    <input type="range" id="store-music-volume" min="0" max="100" value="15">
                </div>
            </div>
            
            <!-- BAR GUIDE - Free cocktail recipes -->
            <div class="bar-menu-section">
                <h2>üç∏ The Bar Guide</h2>
                <p class="bar-tagline">What the residents drink. Recipes on the house.</p>
                <div class="bar-menu-grid" id="bar-menu-grid">
                    <!-- Cocktails injected by JS -->
                </div>
                <button class="bar-toggle" id="bar-toggle" onclick="toggleBarMenu()">Show Full Bar Menu ‚ñº</button>
            </div>
            
            <h2>Sensory Packs</h2>
            <p class="store-tagline">Physical artifacts from the hotel. Things you can hold, smell, taste. The fiction made tangible.</p>
            
            <div class="store-grid" id="store-grid">
                <!-- Products injected by JS -->
            </div>
            
            <p class="store-notice">
                <strong>THE KNOCK</strong> brought to you by <em>Past Presence</em> is currently in development.<br>
                Leave your email to be notified when the hotel opens its doors.
            </p>
            <form class="waitlist-form" onsubmit="event.preventDefault(); submitWaitlist(this);">
                <input type="email" name="email" placeholder="your@email.com" required>
                <button type="submit">Join Waitlist</button>
            </form>
        </div>
    </div>
    
    <!-- About Modal -->
    <div id="about-modal" class="modal hidden">
        <div class="modal-content">
            <button class="modal-close" id="about-close">√ó</button>
            <div class="about-text">
                <p class="about-lead">Someone is at your door.</p>
                <p>They have something to tell you. Whether you believe them is up to you.</p>
                <p>HEARSAY is a series of conversational experiences. No puzzles. No right answers. Just unreliable narrators and the stories they tell.</p>
                <p class="about-tagline">Somewhere between a novel, a play, a movie, a mystery, a dream, a confession, and a communion.</p>
            </div>
        </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         EXPERIENCE PAGE - Peephole Interface
         ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div id="experience-page" class="page">
        <div id="hearsay-app">
            <!-- Layer 0: Hallway Background - always visible, full screen -->
            <div id="layer-background" class="video-layer">
                <video id="video-hallway" loop muted playsinline autoplay>
                    <source src="assets/videos/Background_1.mp4" type="video/mp4">
                </video>
            </div>

            <!-- Face Container: shared mount for walkup videos AND Simli -->
            <!-- This is centered in the peephole, sized to fit the opening -->
            <div id="face-container">
                <!-- Layer 1: Transition/Walkup Videos -->
                <div id="layer-transition" class="face-layer hidden">
                    <video id="video-transition" muted playsinline></video>
                </div>

                <!-- Layer 2: Simli Widget -->
                <div id="layer-simli" class="face-layer hidden">
                    <div id="simli-mount"></div>
                </div>
            </div>

            <!-- Layer 3: Peephole Frame -->
            <div id="layer-peephole" class="overlay-layer">
                <div id="peephole-mask">
                    <div id="peephole-glass"></div>
                </div>
            </div>

            <!-- Layer 4: Peephole overlay - full screen with transparent center -->
            <div id="layer-door-overlay" class="overlay-layer">
                <img src="assets/images/overlay.png" alt="" id="peephole-overlay">
            </div>

            <!-- Vignette -->
            <div id="vignette-overlay"></div>
        </div>

        <!-- Experience Controls -->
        <div id="experience-controls" class="experience-ui">
            <button id="btn-dismiss" class="btn-dismiss" disabled>Send Away</button>
            <button id="btn-back" class="btn-back">‚Üê Back</button>
        </div>

        <!-- Character info overlay -->
        <div id="character-info" class="character-info">
            <span id="current-character-name"></span>
            <span id="current-character-role"></span>
        </div>
    </div>

    <!-- Audio elements -->
    <audio id="audio-knock" preload="auto">
        <source src="assets/sounds/door_knocks/knock_hotel_1.wav" type="audio/wav">
    </audio>
    
    <!-- Ambient track - single loop -->
    <audio id="ambient-main" class="ambient-track" loop preload="auto">
        <source src="assets/sounds/hotel_hallway_subtle_3a.wav" type="audio/wav">
    </audio>
    
    <!-- Music track - single loop -->
    <audio id="music-main" class="music-track" loop preload="auto">
        <source src="assets/sounds/MataZ.wav" type="audio/wav">
    </audio>
    
    <!-- Audio Controls -->
    <div id="audio-controls" class="audio-controls">
        <button id="audio-toggle" class="audio-toggle">üîä</button>
        <div class="volume-sliders">
            <div class="slider-group">
                <label>Ambient</label>
                <input type="range" id="ambient-volume" min="0" max="100" value="65">
            </div>
            <div class="slider-group">
                <label>Music</label>
                <input type="range" id="music-volume" min="0" max="100" value="15">
            </div>
        </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         APPLICATION LOGIC
         ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <script type="module">
        import { config, characters, platform, experience } from './config.js';
        import { StateMachine } from './state-machine.js';
        import { Compositor } from './compositor.js';
        import { SimliIntegration } from './simli-integration.js';

        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        // PAGE MANAGEMENT
        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        
        const landingPage = document.getElementById('landing-page');
        const experiencePage = document.getElementById('experience-page');
        
        function showLanding() {
            landingPage.classList.add('active');
            experiencePage.classList.remove('active');
        }
        
        function showExperience() {
            landingPage.classList.remove('active');
            experiencePage.classList.add('active');
        }

        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        // CHARACTER GALLERY
        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        
        const gallery = document.getElementById('character-gallery');
        const characterKeys = Object.keys(characters);
        const totalChars = characterKeys.length;
        
        // Orbital positioning - characters arranged around the peephole
        // Start at 120¬∞ (lower left), go to 420¬∞ (lower right), avoiding top where title is
        // This creates a horseshoe shape around the bottom/sides
        const startAngle = 120;
        const endAngle = 420; // 420 = 60¬∞ on the right side
        const angleStep = (endAngle - startAngle) / (totalChars - 1);
        
        characterKeys.forEach((key, index) => {
            const character = characters[key];
            const card = document.createElement('div');
            card.className = 'character-card';
            card.dataset.character = key;
            
            // Add coming_soon class if not ready
            if (character.status === 'coming_soon') {
                card.classList.add('coming-soon');
            }
            
            // Calculate radial position
            const angle = startAngle + (index * angleStep);
            card.style.setProperty('--angle', `${angle}deg`);
            card.dataset.angle = angle;
            
            // Check if we have a preview video
            const videoSrc = character.previewVideo || 
                (character.idleToActive && character.idleToActive.length > 0 ? character.idleToActive[0] : null);
            
            card.innerHTML = `
                <div class="character-circle">
                    ${videoSrc ? `
                        <video class="character-preview" loop muted playsinline autoplay>
                            <source src="${videoSrc}" type="video/mp4">
                        </video>
                    ` : `
                        <div class="character-placeholder">
                            <span class="placeholder-initial">${character.name.charAt(0)}</span>
                        </div>
                    `}
                    <div class="character-circle-border"></div>
                    ${character.status === 'coming_soon' ? '<div class="coming-soon-badge">Coming Soon</div>' : ''}
                </div>
                <span class="character-name">${character.name}</span>
                <span class="character-role">${character.role}</span>
            `;
            
            card.addEventListener('click', () => {
                if (character.status === 'coming_soon') {
                    showComingSoonModal(character.name);
                } else {
                    enterExperience(key);
                }
            });
            
            // Play video on hover
            const video = card.querySelector('video');
            if (video) {
                video.play().catch(() => {});
            }
            
            gallery.appendChild(card);
        });
        
        // Coming Soon Modal
        function showComingSoonModal(charName) {
            const modal = document.getElementById('coming-soon-modal');
            const nameEl = modal.querySelector('.coming-soon-name');
            if (nameEl) nameEl.textContent = charName;
            modal.classList.remove('hidden');
        }

        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        // CORE SYSTEMS
        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        
        const stateMachine = new StateMachine();
        const compositor = new Compositor(stateMachine);
        const simli = new SimliIntegration(stateMachine, config);
        
        // UI Elements
        const dismissBtn = document.getElementById('btn-dismiss');
        const backBtn = document.getElementById('btn-back');
        const charNameEl = document.getElementById('current-character-name');
        const charRoleEl = document.getElementById('current-character-role');

        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        // ENTER EXPERIENCE
        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        
        function enterExperience(characterKey) {
            const character = characters[characterKey];
            if (!character) return;
            
            // Update character info display
            charNameEl.textContent = character.name;
            charRoleEl.textContent = character.role;
            
            // Switch to experience view
            showExperience();
            
            // Start the experience - summon character
            setTimeout(() => {
                stateMachine.summonCharacter(characterKey);
            }, 500);
        }

        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        // CONTROLS
        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        
        dismissBtn.addEventListener('click', () => {
            if (stateMachine.currentState === 'active') {
                stateMachine.dismissCharacter();
            }
        });
        
        backBtn.addEventListener('click', () => {
            // If in conversation, dismiss first
            if (stateMachine.currentState === 'active') {
                stateMachine.dismissCharacter();
            }
            // Go back to landing after a moment
            setTimeout(() => {
                stateMachine.reset();
                showLanding();
            }, 300);
        });

        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        // STATE UPDATES
        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        
        stateMachine.on('stateChange', ({ to }) => {
            dismissBtn.disabled = to !== 'active';
        });
        
        stateMachine.on('characterDismissed', () => {
            // Return to landing after character leaves
            setTimeout(() => {
                showLanding();
            }, 500);
        });

        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        // INIT
        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        
        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        // ABOUT MODAL
        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        
        const aboutBtn = document.getElementById('about-btn');
        const aboutModal = document.getElementById('about-modal');
        const aboutClose = document.getElementById('about-close');
        
        aboutBtn?.addEventListener('click', () => {
            aboutModal?.classList.remove('hidden');
        });
        
        aboutClose?.addEventListener('click', () => {
            aboutModal?.classList.add('hidden');
        });
        
        aboutModal?.addEventListener('click', (e) => {
            if (e.target === aboutModal) {
                aboutModal.classList.add('hidden');
            }
        });

        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        // STORE MODAL
        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        
        const storeBtn = document.getElementById('store-btn');
        const storeModal = document.getElementById('store-modal');
        const storeGrid = document.getElementById('store-grid');
        
        // Sensory Pack Products - 9 characters + Hotel sampler
        const storeProducts = [
            {
                id: 'tane',
                name: 'TANE ‚Äî "Live Fast"',
                tagline: 'We\'ll show you what you\'re hiding.',
                price: '$35',
                images: [
                    'assets/images/Sensory Packs/Sensory_Tane_Vertical.jpeg',
                    'assets/images/Sensory Packs/sensory_Tane_Good.png',
                    'assets/images/Sensory Packs/Sensory_Pack_Tane_2.png'
                ],
                image: 'assets/images/Sensory Packs/Sensory_Tane_Vertical.jpeg',
                featured: true,
                description: 'The box glows like a bad idea at 2am. Open it and remember what ambition smelled like before it learned consequences.',
                contents: [
                    'Energy drink powder ("MIX WITH VODKA OR REGRET")',
                    'Temporary tattoo sheet ‚Äî horse, "LONG ODDS", anatomical heart',
                    '"PULSE" cologne ‚Äî synthetic musk, pheromones, rubber accord, patchouli, castoreum, sandalwood, petrichor',
                    '"THE STARTING GATE" matchbook',
                    'Scratch-off fortune cards',
                    'Submission card ‚Äî "Send us your face." (Trust us.)',
                    'Polaroids from an evening you don\'t remember',
                    'Sticky note ‚Äî handwriting not yours'
                ],
                cocktail: 'Energy drink vodka shot',
                virgin: 'Energy drink straight'
            },
            {
                id: 'wire',
                name: 'WIRE ‚Äî "The Sixth Floor"',
                tagline: 'For patience. Steep until you understand.',
                price: '$35',
                image: null,
                description: 'Arrives wrapped in brown paper like a secret. Smells of old wood and patience. Some things take longer to understand.',
                contents: [
                    'Kawakawa & mƒÅnuka honey tea blend',
                    'Vintage sugar cubes in tin',
                    'Racing form guide ‚Äî hand-annotated',
                    'Sandalwood & petrichor scent',
                    'Brass key "614"',
                    'Huia feather replica',
                    'Sticky note ‚Äî "He knows more than he says"'
                ],
                cocktail: 'Hot Toddy with mƒÅnuka honey',
                virgin: 'Tea-based toddy'
            },
            {
                id: 'marisol',
                name: 'MARISOL ‚Äî "The Inheritance"',
                tagline: 'What he knew. What he didn\'t tell me.',
                price: '$35',
                images: [
                    'assets/images/Sensory Packs/Sensory_Marisol_vertical.png',
                    'assets/images/Sensory Packs/Sensory_Marisol.png',
                    'assets/images/Sensory Packs/Sensory_Marisol.2.png'
                ],
                description: 'Sealed with her family crest. Inside: the things daughters inherit when fathers die badly. Some assembly required.',
                contents: [
                    'Brass key ‚Äî room number scratched off',
                    'Wax seal kit with Vance crest',
                    'Two scent vials: "HER" and "THE DISGUISE"',
                    'Theatrical false lashes',
                    'Redacted legal document',
                    'Polaroid ‚Äî figure in fourth floor window',
                    'Sticky note ‚Äî "Don\'t trust the daughter"'
                ],
                cocktail: 'Dark & Stormy',
                virgin: 'Ginger lime spritz'
            },
            {
                id: 'eddie',
                name: 'EDDIE ‚Äî "The Night Kitchen"',
                tagline: 'For when you can\'t sleep. Make this. Feel better.',
                price: '$35',
                image: null,
                description: 'Warm before you open it. The remedy for 3am hunger, loneliness, and questions you can\'t ask in daylight.',
                contents: [
                    'Mole spice blend in clay pot',
                    'Tamarind candies (Pulparindo style)',
                    'Loter√≠a cards: La Luna, El Coraz√≥n, La Muerte',
                    'Mexican vanilla from Papantla',
                    'Kitchen scent ‚Äî tortilla, woodsmoke, cumin',
                    'Champurrado recipe card',
                    'Sticky note ‚Äî "He saw something that night"'
                ],
                cocktail: 'Michelada',
                virgin: 'Virgin michelada'
            },
            {
                id: 'dotty',
                name: 'DOTTY ‚Äî "Room 308"',
                tagline: 'She was somebody once.',
                price: '$35',
                image: null,
                description: 'Smells like 1962 and regrets she doesn\'t have. Contains everything a woman needs to have been beautiful.',
                contents: [
                    'Horehound drops in dented silver tin',
                    'Mini bottle labeled "MEDICINAL PURPOSES"',
                    'Gin botanical sachet',
                    'Lipstick-stained cocktail napkin',
                    'Tarnished compact mirror, initialed "D.M."',
                    'B&W photograph ‚Äî beautiful woman, 1960s',
                    'Sticky note ‚Äî "She remembers everything"'
                ],
                cocktail: 'Gin Fizz',
                virgin: 'Botanical lemonade fizz'
            },
            {
                id: 'constance',
                name: 'CONSTANCE ‚Äî "Fourth Floor"',
                tagline: 'Observed. Noted. Filed.',
                price: '$35',
                image: null,
                description: 'Arrives precisely. Contains the tools of someone who watches. You\'ll want to meet her standards.',
                contents: [
                    'Pressed flowers from the hotel garden',
                    'Calling card ‚Äî just her name, no contact',
                    'Green aldehydic perfume sample',
                    'Note: "I know why you\'re here. Do you?"',
                    'Brass magnifying glass',
                    'Vintage bookplate ‚Äî name scratched out',
                    'Sticky note ‚Äî "Fourth floor. After midnight."'
                ],
                cocktail: 'Pimm\'s Cup',
                virgin: 'Cucumber mint lemonade'
            },
            {
                id: 'priya',
                name: 'PRIYA ‚Äî "Trust Me"',
                tagline: 'What happens at the bar stays at the bar. Mostly.',
                price: '$35',
                image: null,
                description: 'The bartender knows everything. This is what she carries. Bitter, complicated, worth the trouble.',
                contents: [
                    'Bar towel embroidered "P.R."',
                    'Mismatched cocktail stirrers',
                    'Bitters sampler ‚Äî numbered 1, 2, 3',
                    'Hotel bar matchbook',
                    'Scent: fernet, mezcal, citrus peel',
                    'Ceramic olive (joke or keepsake, unclear)',
                    'Sticky note ‚Äî "Ask about the tab"'
                ],
                cocktail: 'The Trust Me ‚Äî fernet & mezcal',
                virgin: 'Bitter botanical soda with grapefruit'
            },
            {
                id: 'lenny',
                name: 'LENNY ‚Äî "The Comedian"',
                tagline: 'Thank you, you\'ve been a beautiful audience.',
                price: '$35',
                image: null,
                description: 'Looks like it\'s been through a few tours. Smells like rental cars and mints that aren\'t fooling anyone. Funny in a way that hurts.',
                contents: [
                    '"LAUGH TRACK LOUNGE" matchbook',
                    'Cheap breath mints in dented tin',
                    'Mini whiskey bottle (maybe refilled)',
                    'Crumpled setlist ‚Äî "hotel bit ‚Äî too real?"',
                    'Motel soap from "The Restwell"',
                    'Fake business card ‚Äî numbers crossed out',
                    'Sticky note ‚Äî "His jokes aren\'t jokes"'
                ],
                cocktail: 'Irish Coffee',
                virgin: 'Just sad coffee'
            },
            {
                id: 'caleb',
                name: 'CALEB ‚Äî "The Author"',
                tagline: 'I made this. I\'m still not sure why.',
                price: '$35',
                image: null,
                description: 'From the person who made all the others. Meta, yes. But also: real tools for making sense of fiction. Handle with curiosity.',
                contents: [
                    'Polaroid ‚Äî author\'s workspace',
                    'Handwritten note about the characters',
                    'Used paintbrush, bristles stained',
                    'Studio scent: linseed oil, turpentine, coffee',
                    'Exhibition postcard',
                    'Blank notebook for your notes',
                    'Sticky note ‚Äî "Who wrote this?"'
                ],
                cocktail: 'Bourbon neat',
                virgin: 'Black coffee'
            },
            {
                id: 'rufus',
                name: 'RUFUS ‚Äî "The Performance"',
                tagline: 'I\'m not one to gossip, BUT‚Äî',
                price: '$35',
                image: null,
                description: 'Red velvet packaging. Smells of greasepaint and champagne. Contains everything you need to watch and be watched. The clown sees all.',
                contents: [
                    'Red foam clown nose',
                    'Miniature Elizabethan ruff ‚Äî stiff white lace',
                    'Theatrical makeup compact ‚Äî greasepaint and rouge',
                    'Dried rose petals ‚Äî from a bouquet or a funeral',
                    'Glass bottle labeled "TEARS (GLYCERIN)"',
                    'Polaroid ‚Äî party, faces scratched out',
                    'Miniature opera glasses ‚Äî gold and mother of pearl',
                    'Scent: champagne, powder, roses, salt, applause',
                    'Scroll tied with red ribbon ‚Äî gossip column, blind items',
                    'Sticky note ‚Äî "Everyone performs. Some of us admit it."'
                ],
                cocktail: 'Kir Royale ‚Äî cr√®me de cassis + champagne',
                virgin: 'Sparkling grape with cassis'
            },
            {
                id: 'hotel',
                name: 'THE HOTEL PACK ‚Äî "Room 412"',
                tagline: 'The Hallway at 3am.',
                price: '$68',
                image: null,
                featured: true,
                description: 'The complete introduction. Opens like a door. Smells like the hallway at 3am. A piece of everyone who lives here.',
                contents: [
                    'Room 412 leather key tag',
                    'Do Not Disturb sign (vintage style)',
                    'Hotel matchbook ‚Äî Est. 1943',
                    '"Hallway at 3am" signature scent',
                    'Annotated floor plan with handwritten notes',
                    'Note slipped under door: "We know you\'re in there."',
                    'ONE SAMPLE FROM EACH CHARACTER',
                    'Stack of sticky notes ‚Äî some in your handwriting, some not'
                ],
                cocktail: 'Room 412 Signature ‚Äî amber, bitter, mysterious',
                virgin: 'Bitters and soda with orange'
            }
        ];
        
        // BAR MENU - Elaborate cocktail descriptions (free to view)
        const barMenuDrinks = [
            {
                character: 'WIRE',
                drink: 'The Sixth Floor Toddy',
                recipe: 'MƒÅnuka honey, good whiskey (he has opinions), kawakawa leaf, hot water.',
                story: 'What Wire drinks when the hallways get too quiet. The honey is from home. The whiskey is from somewhere that closed a long time ago. He drinks it slow, like he does everything.',
                virgin: 'Same, minus the whiskey. Still warms you the same way, he says.',
                mood: 'üåô'
            },
            {
                character: 'MARISOL',
                drink: 'The Dark & Stormy',
                recipe: 'Dark rum, ginger beer, lime wedge. Serve in the glass your father used.',
                story: 'Marisol orders it like a challenge. Dark and stormy ‚Äî like the inheritance, like the hotel, like her. She learned to make it from her father before she learned everything else.',
                virgin: 'Ginger lime spritz. Sharp enough to cut through any conversation.',
                mood: '‚ö°'
            },
            {
                character: 'EDDIE',
                drink: 'The Night Kitchen Michelada',
                recipe: 'Beer, lime, hot sauce (the kind that hurts), Worcestershire, salt rim.',
                story: 'Eddie makes this at 3am when he catches you in the kitchen. "Hair of the dog that\'s about to bite you." He learned it from his grandmother. Or he made that up. Hard to tell with Eddie.',
                virgin: 'Spicy tomato juice with everything but the beer. Still wakes you up.',
                mood: 'üå∂Ô∏è'
            },
            {
                character: 'DOTTY',
                drink: 'The Gin Fizz',
                recipe: 'Gin, lemon, sugar, cream, egg white, soda. Shake until your arm remembers 1962.',
                story: 'Dotty taught three bartenders how to make this properly. None of them still work here. She drinks it in the afternoon, never at night. At night she drinks something else, but that\'s not on the menu.',
                virgin: 'Botanical lemonade fizz. Pretty enough. Not the same.',
                mood: 'üíã'
            },
            {
                character: 'TANE',
                drink: 'The Starting Gate',
                recipe: 'Vodka, energy drink, whatever you\'re running from. Serve it now, ask questions never.',
                story: 'Tane doesn\'t sip. Tane shoots. This is the pre-game before the game before the thing you\'re going to regret. He\'ll match you one for one. He\'ll win.',
                virgin: 'Energy drink straight. Same chaos, less excuse.',
                mood: 'üî•'
            },
            {
                character: 'CONSTANCE',
                drink: 'The Pimm\'s Cup',
                recipe: 'Pimm\'s, cucumber, lemon, ginger ale. Garnish with precision.',
                story: 'Constance drinks Pimm\'s because it\'s civilized. Because you can drink it in the garden and still observe. She takes notes on what other people order. She has a system.',
                virgin: 'Cucumber mint lemonade. Refreshing and deeply judgmental.',
                mood: 'üìã'
            },
            {
                character: 'PRIYA',
                drink: 'The Trust Me',
                recipe: 'Fernet, mezcal, citrus. Amaro to taste. She won\'t tell you the proportions.',
                story: 'The bartender\'s bartender drink. Priya makes it different every time. You don\'t order it ‚Äî you just ask her what you need, and this is what you get. She\'s usually right.',
                virgin: 'Bitter botanical soda with grapefruit. For when you need to stay sharp.',
                mood: 'üçã'
            },
            {
                character: 'LENNY',
                drink: 'The Irish Goodbye',
                recipe: 'Hot coffee, Irish whiskey, brown sugar, cream floated on top.',
                story: 'Lenny orders this after every set. The good ones and the bad ones. He holds the cup with both hands. "At least the coffee never heckles," he says, every time. Every single time.',
                virgin: 'Just sad coffee. He\'ll tell you the joke about that too.',
                mood: '‚òï'
            },
            {
                character: 'CALEB',
                drink: 'The Bourbon Neat',
                recipe: 'Bourbon. Glass. That\'s it.',
                story: 'The author drinks what writers drink in movies. He knows it\'s a clich√©. He wrote a short story about the clich√© once. It wasn\'t good. He still orders it.',
                virgin: 'Black coffee. He\'ll take notes on how you take yours.',
                mood: 'üìù'
            },
            {
                character: 'RUFUS',
                drink: 'The Kir Royale',
                recipe: 'Cr√®me de cassis, champagne. Bubbles and darkness.',
                story: '"Bubbles and darkness, darling. Like me." Rufus raises his glass to everyone and no one. He never finishes the first one. There\'s always a second one waiting.',
                virgin: 'Sparkling grape with cassis. Still dramatic. Still Rufus.',
                mood: 'üé≠'
            }
        ];
        
        // Populate bar menu
        const barMenuGrid = document.getElementById('bar-menu-grid');
        barMenuDrinks.forEach(drink => {
            const drinkEl = document.createElement('div');
            drinkEl.className = 'bar-drink-card';
            drinkEl.innerHTML = `
                <div class="drink-header">
                    <span class="drink-mood">${drink.mood}</span>
                    <span class="drink-character">${drink.character}</span>
                </div>
                <h4 class="drink-name">${drink.drink}</h4>
                <p class="drink-recipe">${drink.recipe}</p>
                <p class="drink-story">${drink.story}</p>
                <p class="drink-virgin"><strong>Virgin:</strong> ${drink.virgin}</p>
            `;
            barMenuGrid.appendChild(drinkEl);
        });
        
        // Toggle bar menu visibility
        window.toggleBarMenu = function() {
            const grid = document.getElementById('bar-menu-grid');
            const toggle = document.getElementById('bar-toggle');
            grid.classList.toggle('expanded');
            toggle.textContent = grid.classList.contains('expanded') 
                ? 'Hide Bar Menu ‚ñ≤' 
                : 'Show Full Bar Menu ‚ñº';
        };
        
        // Populate store grid
        storeProducts.forEach(product => {
            const productEl = document.createElement('div');
            productEl.className = 'store-product' + (product.featured ? ' featured' : '');
            productEl.dataset.productId = product.id;
            
            const contentsHtml = product.contents ? 
                `<ul class="product-contents">${product.contents.map(item => `<li>${item}</li>`).join('')}</ul>` : '';
            
            // Image gallery for products with multiple images
            let imageHtml = '';
            if (product.images && product.images.length > 1) {
                imageHtml = `
                    <div class="product-gallery">
                        <img src="${product.images[0]}" alt="${product.name}" class="gallery-main" id="gallery-${product.id}">
                        <div class="gallery-thumbs">
                            ${product.images.map((img, i) => `<img src="${img}" onclick="document.getElementById('gallery-${product.id}').src='${img}'" class="${i===0?'active':''}">`).join('')}
                        </div>
                    </div>
                `;
            } else if (product.image) {
                imageHtml = `<div class="product-image"><img src="${product.image}" alt="${product.name}"></div>`;
            } else {
                imageHtml = `<div class="product-image"><div class="product-placeholder">${product.id === 'hotel' ? 'The Complete Experience' : 'Image Coming'}</div></div>`;
            }
            
            productEl.innerHTML = `
                ${product.featured ? '<div class="featured-badge">‚ú¶ Available Now</div>' : ''}
                ${imageHtml}
                <h3 class="product-name">${product.name}</h3>
                <p class="product-tagline">${product.tagline || ''}</p>
                <p class="product-description">${product.description}</p>
                
                <div class="product-details collapsed">
                    <h4>Contains:</h4>
                    ${contentsHtml}
                    <div class="product-cocktails">
                        <span class="cocktail-label">üç∏ ${product.cocktail}</span>
                        <span class="virgin-label">‚òï Virgin: ${product.virgin}</span>
                    </div>
                </div>
                
                <button class="details-toggle" onclick="toggleProductDetails(this)">View Contents ‚ñº</button>
                
                <div class="product-footer">
                    <span class="product-price">${product.price}</span>
                    <button class="product-btn" onclick="showStoreWaitlist('${product.name}')">Add to Cart</button>
                </div>
            `;
            storeGrid.appendChild(productEl);
        });
        
        // Toggle product details
        window.toggleProductDetails = function(btn) {
            const details = btn.previousElementSibling;
            const isCollapsed = details.classList.contains('collapsed');
            details.classList.toggle('collapsed');
            btn.textContent = isCollapsed ? 'Hide Contents ‚ñ≤' : 'View Contents ‚ñº';
        };
        
        storeBtn?.addEventListener('click', () => {
            storeModal?.classList.remove('hidden');
        });
        
        storeModal?.addEventListener('click', (e) => {
            if (e.target === storeModal) {
                storeModal.classList.add('hidden');
            }
        });
        
        // Waitlist submission (placeholder)
        window.submitWaitlist = function(form) {
            const email = form.querySelector('input[name="email"]').value;
            alert(`Thanks! We'll reach out to ${email} when the hotel opens.`);
            form.reset();
            document.querySelectorAll('.modal').forEach(m => m.classList.add('hidden'));
        };
        
        window.showStoreWaitlist = function(productName) {
            alert(`THE KNOCK is gearing up. "${productName}" will be available soon. Leave your email in the form below to be notified!`);
        };

        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        // AUDIO SYSTEM
        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        
        const ambientTracks = document.querySelectorAll('.ambient-track');
        const musicTrack = document.getElementById('music-main');
        const ambientSlider = document.getElementById('ambient-volume');
        const musicSlider = document.getElementById('music-volume');
        const audioToggle = document.getElementById('audio-toggle');
        
        let audioStarted = false;
        let audioMuted = false;
        
        // Set initial volumes
        function updateAmbientVolume(value) {
            const vol = value / 100;
            ambientTracks.forEach(track => {
                track.volume = vol;
            });
        }
        
        function updateMusicVolume(value) {
            const vol = value / 100;
            if (musicTrack) musicTrack.volume = vol;
        }
        
        // Start all audio (must be triggered by user interaction)
        function startAudio() {
            if (audioStarted) return;
            audioStarted = true;
            
            // Start ambient tracks
            ambientTracks.forEach(track => {
                track.volume = ambientSlider.value / 100;
                track.play().catch(e => console.log('Ambient blocked:', e));
            });
            
            // Start music (single track, loops)
            if (musicTrack) {
                musicTrack.volume = musicSlider.value / 100;
                musicTrack.play().catch(e => console.log('Music blocked:', e));
            }
            
            audioMuted = false;
            audioToggle.textContent = 'üîä';
            audioToggle.classList.add('playing');
        }
        
        // Toggle mute
        function toggleAudio() {
            if (!audioStarted) {
                startAudio();
                return;
            }
            
            audioMuted = !audioMuted;
            
            // Mute/unmute all audio
            ambientTracks.forEach(track => track.muted = audioMuted);
            if (musicTrack) musicTrack.muted = audioMuted;
            
            audioToggle.textContent = audioMuted ? 'üîá' : 'üîä';
            audioToggle.classList.toggle('playing', !audioMuted);
        }
        
        // Event listeners
        audioToggle.addEventListener('click', toggleAudio);
        ambientSlider.addEventListener('input', (e) => updateAmbientVolume(e.target.value));
        musicSlider.addEventListener('input', (e) => updateMusicVolume(e.target.value));
        
        // Store modal volume controls (sync with main controls)
        const storeAmbientSlider = document.getElementById('store-ambient-volume');
        const storeMusicSlider = document.getElementById('store-music-volume');
        const storeAudioToggle = document.getElementById('store-audio-toggle');
        
        if (storeAmbientSlider) {
            storeAmbientSlider.addEventListener('input', (e) => {
                updateAmbientVolume(e.target.value);
                ambientSlider.value = e.target.value;  // Sync main slider
            });
        }
        if (storeMusicSlider) {
            storeMusicSlider.addEventListener('input', (e) => {
                updateMusicVolume(e.target.value);
                musicSlider.value = e.target.value;  // Sync main slider
            });
        }
        if (storeAudioToggle) {
            storeAudioToggle.addEventListener('click', () => {
                toggleAudio();
                storeAudioToggle.textContent = audioMuted ? 'üîá' : 'üîä';
            });
        }
        
        // Sync store sliders when store modal opens
        document.getElementById('store-btn')?.addEventListener('click', () => {
            if (storeAmbientSlider) storeAmbientSlider.value = ambientSlider.value;
            if (storeMusicSlider) storeMusicSlider.value = musicSlider.value;
            if (storeAudioToggle) storeAudioToggle.textContent = audioMuted ? 'üîá' : 'üîä';
        });
        
        // Start audio on first click anywhere on page
        document.body.addEventListener('click', () => {
            if (!audioStarted) startAudio();
        }, { once: true });
        
        // Also try on any touch (mobile)
        document.body.addEventListener('touchstart', () => {
            if (!audioStarted) startAudio();
        }, { once: true });

        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        // LANDING VIDEO LOOP WITH PAUSE ON FIRST FRAME
        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        
        const landingVideo = document.getElementById('landing-video');
        const PAUSE_DURATION = 5000; // 5 seconds pause on first frame
        
        if (landingVideo) {
            // Start paused
            landingVideo.pause();
            landingVideo.currentTime = 0;
            
            // After pause duration, play the video
            setTimeout(() => {
                landingVideo.play();
            }, PAUSE_DURATION);
            
            // When video ends, go back to start and pause again
            landingVideo.addEventListener('ended', () => {
                landingVideo.currentTime = 0;
                landingVideo.pause();
                
                // After pause, play again
                setTimeout(() => {
                    landingVideo.play();
                }, PAUSE_DURATION);
            });
        }

        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        // INIT
        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        
        // Expose for debugging
        window.hearsay = { stateMachine, compositor, simli, config, characters, platform, experience };
        console.log(`${platform.name} ‚Äî ${experience.name} initialized`);
    </script>
</body>
</html>
